<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SERON Chat Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
margin:0;
font-family:Arial;
background:#0b141a;
color:white;
display:flex;
flex-direction:column;
align-items:center;
}
.brand{
text-align:center;
font-size:24px;
font-weight:bold;
color:#ff5722;
text-shadow:0 0 15px orange;
margin:10px;
}
.container{
width:95vw;
max-width:420px;
aspect-ratio:9/16;
background:#111b21;
display:flex;
flex-direction:column;
border-radius:12px;
overflow:hidden;
}
header{
background:#202c33;
padding:10px;
display:flex;
justify-content:space-between;
font-size:14px;
}
#chat{
flex:1;
overflow-y:auto;
padding:10px;
}
.msg{
padding:8px;
margin:6px;
border-radius:8px;
max-width:70%;
word-wrap:break-word;
}
.me{ background:#005c4b; margin-left:auto; }
.other{ background:#202c33; }
.controls{
display:flex;
gap:5px;
padding:8px;
background:#202c33;
}
input{
flex:1;
padding:10px;
border:none;
border-radius:6px;
}
button{
padding:10px;
border:none;
border-radius:6px;
cursor:pointer;
font-size:14px;
}
.menu{
text-align:center;
margin-top:20px;
}
.roomCode{
font-size:18px;
margin-top:10px;
word-break:break-word;
}
.footer{
margin-top:10px;
color:#ff5722;
text-shadow:0 0 10px orange;
}
</style>
</head>
<body>

<div class="brand">ðŸ”¥ SERON ðŸ”¥</div>

<!-- MAIN MENU -->
<div id="menu" class="menu">
<h2>Chat Room</h2>

<button onclick="createRoom()">Create Room</button>
<br><br>

<input id="joinCode" placeholder="Enter Room Code">
<br><br>

<button onclick="joinRoom()">Join Room</button>

<div id="roomDisplay" class="roomCode"></div>
</div>

<!-- CHAT UI -->
<div id="chatUI" class="container" style="display:none">

<header>
<div>Room: <span id="roomLabel"></span></div>
<div>
<button onclick="shareRoom()">Share</button>
<button id="adminBtn" onclick="adminDelete()" style="display:none">Delete</button>
</div>
</header>

<div id="chat"></div>

<div class="controls">
<input id="msg" placeholder="Type message">
<button onclick="sendMsg()">Send</button>
<button onclick="leave()">Leave</button>
</div>

</div>

<div class="footer">ðŸ”¥ SERON ðŸ”¥</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase config */
const firebaseConfig = {
apiKey:"AIzaSyC4...",
authDomain:"chat-data-59467.firebaseapp.com",
databaseURL:"https://chat-data-59467-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"chat-data-59467"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* GLOBALS */
let room="";
let user="User"+Math.floor(Math.random()*9999);
let isAdmin=false;

/* Generate 16-char alphanumeric room code */
function generateRoomCode(){
const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
let code="";
for(let i=0;i<16;i++){
code += chars.charAt(Math.floor(Math.random()*chars.length));
}
return code;
}

/* CREATE ROOM */
window.createRoom=function(){
room=generateRoomCode();
document.getElementById("roomDisplay").innerHTML=
"Room Code: "+room+"<br><button onclick='copyCode()'>Copy Code</button>";
isAdmin=true;
document.getElementById("adminBtn").style.display="inline-block";
startChat(); // creator auto opens chat
}

/* COPY ROOM CODE */
window.copyCode=function(){
navigator.clipboard.writeText(room);
alert("Copied!");
}

/* JOIN ROOM */
window.joinRoom=function(){
room=document.getElementById("joinCode").value;
if(!room){ alert("Invalid room"); return; }
isAdmin=false;
document.getElementById("adminBtn").style.display="none";
startChat();
}

/* START CHAT */
function startChat(){
document.getElementById("menu").style.display="none";
document.getElementById("chatUI").style.display="flex";
document.getElementById("roomLabel").innerText=room;

// Add user to room
set(ref(db,"rooms/"+room+"/users/"+user),true);

// Listen for messages
listenMessages();
}

/* LISTEN CHAT */
function listenMessages(){
const msgRef=ref(db,"rooms/"+room+"/messages");
onValue(msgRef,snap=>{
let chat=document.getElementById("chat");
chat.innerHTML="";
snap.forEach(m=>{
let d=m.val();
let div=document.createElement("div");
div.className="msg "+(d.user==user?"me":"other");
div.innerText=d.user+": "+d.text;
chat.appendChild(div);
});
chat.scrollTop = chat.scrollHeight;
});
}

/* SEND MESSAGE */
window.sendMsg=function(){
let text=document.getElementById("msg").value;
if(!text) return;
push(ref(db,"rooms/"+room+"/messages"),{user:user,text:text});
document.getElementById("msg").value="";
}

/* LEAVE ROOM */
window.leave=function(){
remove(ref(db,"rooms/"+room+"/users/"+user));
location.href=location.pathname;
}

/* ADMIN DELETE ROOM */
window.adminDelete=function(){
if(!isAdmin) return;
if(confirm("Delete Room?")){
remove(ref(db,"rooms/"+room));
alert("Room Deleted");
location.href=location.pathname;
}
}

/* SHARE ROOM */
window.shareRoom=function(){
let link=location.origin+location.pathname+"?room="+room;
navigator.share?.({
title:"Join SERON Chat",
text:"Join my room",
url:link
}) || alert(link);
}

/* AUTO JOIN FROM DIRECT LINK */
function autoJoinFromLink(){
const params = new URLSearchParams(window.location.search);
const r = params.get("room");
if(r){
room = r;
isAdmin=false;
document.getElementById("adminBtn").style.display="none";
startChat();
}
}
window.onload = autoJoinFromLink;

</script>
</body>
</html>
